import{j as e,r as h}from"./client-CFcKg02j.js";import{u as z}from"./client-D3RtENOo.js";import{c as R}from"./client-CFu2U_VC.js";import{P as k}from"./client-VVoV6ae_.js";import{n as M,g as E,s as F}from"./client-BPRoBE_I.js";import{u as A}from"./client-ye_Tc8aY.js";import"./client-BX9QSSmL.js";import"./client-DW_MHI2K.js";import"./client-Bg0f9_HF.js";import"./client-DcEZrv79.js";import"./client-vn6Di64w.js";import"./client-CEm0v9VI.js";import"./client-5a4Y-fw1.js";const x=()=>document.getElementById("question_result_modal").click(),J=({result:o})=>{const l=M(o);return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",id:"question_result_modal",className:"modal-toggle"}),e.jsx("div",{id:"question_result_modal",className:"modal",role:"dialog",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("div",{className:l<50?"bg-error text-error-content":l>=50&&l<80?"bg-warning text-warning-content":"bg-success text-success-content",children:e.jsxs("h3",{className:"text-xl font-semibold p-3 text-center",children:["Sizning javobingiz to'g'ri javobga ",l,"% ga o'xshash."]})}),e.jsx("div",{className:"flex gap-3 mt-3",children:e.jsx("button",{type:"button",className:"btn btn-warning",onClick:x,children:"Yopish"})})]})})]})},L=.5,H=()=>{var u;const[o,l]=h.useState(E("data")),[g,p]=h.useState(0),{question_data:m,scores:s,user:b}=o,t=m[s.length].questions.find(r=>r.score===null),{register:j,handleSubmit:v,getValues:d,setValue:_,formState:{errors:f}}=A(),{mutate:y,data:a,isPending:N,isIdle:w}=z({mutationKey:["checkAnswer",t.id],mutationFn:()=>R({question_id:t.id,user_id:b.id,user_answer:d("user_answer")}).then(r=>{p(r.score),l(n=>{const c=m[s.length];if(r.score>=c.max_score&&(c.max_score=r.score),c.questions=c.questions.map(i=>i.id===t.id?{...t,user_answer:d("user_answer"),score:r.score}:i),n.question_data=m.map((i,q)=>q===s.length?c:i),r.score>=L){const i=t.level.code;s.push(i===1?10:i===2?8:6)}else c.questions.find(i=>i.score===null)||s.push(0);if(F("data",{...n,scores:s}),s.length===m.length){window.location.replace("/my_results");return}return _("user_answer",""),{...n,scores:s}})})}),S=()=>{y(),x()};return e.jsxs(e.Fragment,{children:[e.jsx(J,{result:g}),e.jsx(k,{isFetching:!1,isLoading:!1,title:"Savolga javob yozing",breadcrumbs:[{name:((u=o==null?void 0:o.subject)==null?void 0:u.name)||"Savollar"},{name:"Savolga javob yozish"}]}),e.jsxs("div",{className:"lg:p-10 sm:p-3 md:p-5",children:[e.jsx("div",{className:"join mb-3",children:m.map((r,n)=>e.jsx("button",{className:`btn btn-sm ${s.length>=n&&"btn-primary"} join-item`,children:n+1},n))}),e.jsxs("form",{onSubmit:v(S),children:[e.jsxs("p",{className:"text-sm",children:["Savol darajasi: ",t.level.code]}),e.jsx("h4",{className:"first-letter:capitalize text-xl font-semibold",children:t==null?void 0:t.title}),e.jsx("textarea",{...j("user_answer",{required:!0}),rows:4,placeholder:"Javob yozing...",className:"textarea textarea-primary w-full"}),f.user_answer&&e.jsx("span",{className:"text-sm text-error",children:"Javob yozing"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Javobni yuborish va tekshirish"}),N?e.jsx("span",{className:"text-primary loading loading-spinner loading-lg"}):w?null:e.jsxs("div",{className:"text-success font-semibold",children:[e.jsxs("div",{children:["Kosinus o'xshashligi:"," ",Math.round(((a==null?void 0:a.cosine_similarity)||0)*1e3)/1e3]}),e.jsxs("div",{children:["BLEU o'xshashligi:"," ",Math.round(((a==null?void 0:a.bleu_similarity)||0)*1e3)/1e3]}),e.jsxs("div",{children:["Jaccard o'xshashligi:"," ",Math.round(((a==null?void 0:a.jaccard_similarity)||0)*1e3)/1e3]})]})]})]})]})]})};export{H as default};
