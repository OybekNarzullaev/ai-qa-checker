import{j as e,r as d}from"./client-CFcKg02j.js";import{u as y}from"./client-D3RtENOo.js";import{c as q}from"./client-CFu2U_VC.js";import{P as z}from"./client-VVoV6ae_.js";import{n as R,g as k,s as F}from"./client-Choa3Wht.js";import{u as A}from"./client-ye_Tc8aY.js";import"./client-BX9QSSmL.js";import"./client-DW_MHI2K.js";import"./client-Bg0f9_HF.js";import"./client-DcEZrv79.js";import"./client-vn6Di64w.js";import"./client-CEm0v9VI.js";import"./client-5a4Y-fw1.js";const g=()=>document.getElementById("question_result_modal").click(),E=({result:o})=>{const i=R(o);return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",id:"question_result_modal",className:"modal-toggle"}),e.jsx("div",{id:"question_result_modal",className:"modal",role:"dialog",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("div",{className:i<50?"bg-error text-error-content":i>=50&&i<80?"bg-warning text-warning-content":"bg-success text-success-content",children:e.jsxs("h3",{className:"text-xl font-semibold p-3 text-center",children:["Sizning javobingiz to'g'ri javobga ",i,"% ga o'xshash."]})}),e.jsx("div",{className:"flex gap-3 mt-3",children:e.jsx("button",{type:"button",className:"btn btn-warning",onClick:g,children:"Yopish"})})]})})]})},P=.5,$=()=>{var u;const[o,i]=d.useState(k("data")),[x,h]=d.useState(0),{question_data:c,scores:s,user:p}=o,t=c[s.length].questions.find(r=>r.score===null),{register:b,handleSubmit:j,getValues:m,setValue:f,formState:{errors:v}}=A(),{mutate:_,isPending:w}=y({mutationKey:["checkAnswer",t.id],mutationFn:()=>q({question_id:t.id,user_id:p.id,user_answer:m("user_answer")}).then(r=>{h(r.score),i(n=>{const l=c[s.length];if(r.score>=l.max_score&&(l.max_score=r.score),l.questions=l.questions.map(a=>a.id===t.id?{...t,user_answer:m("user_answer"),score:r.score}:a),n.question_data=c.map((a,S)=>S===s.length?l:a),r.score>=P){const a=t.level.code;s.push(a===1?10:a===2?8:6)}else l.questions.find(a=>a.score===null)||s.push(0);if(F("data",{...n,scores:s}),s.length===c.length){window.location.replace("/my_results");return}return f("user_answer",""),{...n,scores:s}})})}),N=()=>{_(),g()};return e.jsxs(e.Fragment,{children:[e.jsx(E,{result:x}),e.jsx(z,{isFetching:!1,isLoading:!1,title:"Savolga javob yozing",breadcrumbs:[{name:((u=o==null?void 0:o.subject)==null?void 0:u.name)||"Savollar"},{name:"Savolga javob yozish"}]}),e.jsxs("div",{className:"lg:p-10 sm:p-3 md:p-5",children:[e.jsx("div",{className:"join mb-3",children:c.map((r,n)=>e.jsx("button",{className:`btn btn-sm ${s.length>=n&&"btn-primary"} join-item`,children:n+1},n))}),e.jsxs("form",{onSubmit:j(N),children:[e.jsxs("p",{className:"text-sm",children:["Savol darajasi: ",t.level.code]}),e.jsx("h4",{className:"first-letter:capitalize text-xl font-semibold",children:t==null?void 0:t.title}),e.jsx("textarea",{...b("user_answer",{required:!0}),rows:4,placeholder:"Javob yozing...",className:"textarea textarea-primary w-full"}),v.user_answer&&e.jsx("span",{className:"text-sm text-error",children:"Javob yozing"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Javobni yuborish va tekshirish"}),w?e.jsx("span",{className:"text-primary loading loading-spinner loading-lg"}):null]})]})]})]})};export{$ as default};
